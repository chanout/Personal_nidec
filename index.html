<!DOCTYPE html>
<html>
  <head>
    <title>Personal check list</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, user-scalable=no"
    />

    <link rel="stylesheet" href="assets/css/main.css" />
    <noscript
      ><link rel="stylesheet" href="assets/css/noscript.css"
    /></noscript>

    <!-- <script src="./node_modules/html5-qrcode/html5-qrcode-scanner.d.ts"></script> -->
    <script type="module">
      import { $api } from "./assets/js/nidec.min.js";

      window.addEventListener("load", async () => {
        window.module = window.module || {};
        window.module.$api = $api;
      });
    </script>
    <style>
      #qr-reader {
        position: absolute !important;
        z-index: 999;
        margin-left: 30%;
        margin-right: 30%;
        top: -1200dvh;
        border-radius: 0px;
        overflow: hidden;
        background-color: black;
        box-shadow: 0px 0px 0px 1000px #00000070;
      }
      #qr-reader__dashboard_section {
        display: none;
      }
    </style>
    <script src="./assets/js/qrcode.js"></script>
  </head>

  <body class="is-preload">
    <!-- Wrapper -->
    <div id="wrapper1">
      <!-- Header -->
      <header id="header">
        <div class="inner">
          <!-- Logo -->
          <a href="index.html" class="logo">
            <span class="symbol"
              ><img src="images/nidec_logo2.gif" alt="" /></span
            ><span class="title">Nidec precision components</span>
          </a>

          <!-- Nav -->
          <nav>
            <ul>
              <li><a href="#menu">Menu</a></li>
            </ul>
          </nav>
        </div>
      </header>

      <!-- Menu -->
      <nav id="menu">
        <h2>Menu</h2>
        <ul>
          <li><a href="index.html">Home</a></li>
          <!-- <li><a href="generic.html">Ipsum veroeros</a></li>
							<li><a href="generic.html">Tempus etiam</a></li>
							<li><a href="generic.html">Consequat dolor</a></li> -->
          <li><a href="about.html">About</a></li>
        </ul>
      </nav>
      <!-- Main -->

      <div id="detail">
        <p1>Model : <a id="model_name"></a></p1><br />
        <p1>Process : <a id="process_name"></a></p1>
        <p>Name : <a id="name"></a></p>
      </div>

      <div id="qr-reader" style="width: 500px"></div>
      <div id="qr-reader-results"></div>

      <div id="main">
        <div class="inner">
          <section class="tiles">
            <article class="style1">
              <span class="image">
                <img src="images/pp4.png" alt="" />
              </span>
              <a onclick="qrcodeReaderOpen('ลงทะเบียน')">
                <h4 style="color: rgb(0, 0, 255)">ลงทะเบียนเข้า</h4>
                <div class="content">
                  <p>Scan QR code ลงทะเบียนเข้า</p>
                </div>
              </a>
            </article>
            <article class="style1">
              <span class="image">
                <img src="images/Out.png" alt="" />
              </span>
              <a href="scan_qr.html">
                <h4 style="color: rgb(0, 0, 255)">ลงทะเบียนออก</h4>
                <div class="content">
                  <p>Scan QR code ลงทะเบียนออกจากระบบ</p>
                </div>
              </a>
            </article>
            <article class="style1">
              <span class="image">
                <img src="images/Toilet1.png" alt="" />
              </span>
              <a onclick="qrcodeReaderOpen('ห้องน้ำ')">
                <h4 style="color: rgb(0, 0, 255)">เข้าห้องน้ำ</h4>
                <div class="content">
                  <p>เข้าห้องน้ำ ในเวลาทำงาน</p>
                </div>
              </a>
            </article>
            <article class="style1">
              <span class="image">
                <img src="images/reject.png" alt="" />
              </span>
              <a href="generic.html">
                <h4 style="color: rgb(0, 0, 255)">ตรวจสอบซ่อม</h4>
                <div class="content">
                  <p>เวลาที่ใช้ในการตรวจสอบ/ซ่อม อีกครั้งจาก QC reject</p>
                </div>
              </a>
            </article>
            <article class="style1">
              <span class="image">
                <img src="images/pngwing.png" alt="" />
              </span>
              <a href="activity.html">
                <h4 style="color: rgb(0, 0, 255)">กิจกรรม อื่นๆ</h4>
                <div class="content">
                  <p>เลือกกิจกรรม อื่นๆ</p>
                </div>
              </a>
            </article>
            <article class="style1">
              <span class="image">
                <img src="images/OT.png" alt="" />
              </span>
              <a href="ot_request.html">
                <h4 style="color: rgb(0, 0, 255)">ทำงานล่วงเวลา</h4>
                <div class="content">
                  <p>ลงชื่อพนักงานในการทำงานล่วงเวลา (สำหรับหัวหน้างาน)</p>
                </div>
              </a>
            </article>
            <article class="style2">
              <span class="image">
                <img src="images/working.png" alt="" />
              </span>
              <a href="user_config.html">
                <h2 style="color: rgb(0, 0, 255)">User config</h2>
                <div class="content">
                  <p>อัพเดทหรือแก้ไข พนักงานประจำกระบวนการผลิต</p>
                </div>
              </a>
            </article>
            <article class="style3">
              <span class="image">
                <img src="images/pic08.jpg" alt="" />
              </span>
              <a href="generic.html">
                <h2>Free</h2>
                <div class="content">
                  <p>รอตอนต่อไป</p>
                </div>
              </a>
            </article>
          </section>
        </div>
      </div>

      <!-- Footer -->
      <footer id="footer">
        <div class="inner">
          <section>
            <h2>Get in touch</h2>
            <form method="post" action="#">
              <div class="fields">
                <div class="field half">
                  <input type="text" name="name" id="name" placeholder="Name" />
                </div>
                <div class="field half">
                  <input
                    type="email"
                    name="email"
                    id="email"
                    placeholder="Email"
                  />
                </div>
                <div class="field">
                  <textarea
                    name="message"
                    id="message"
                    placeholder="Message"
                  ></textarea>
                </div>
              </div>
              <ul class="actions">
                <li><input type="submit" value="Send" class="primary" /></li>
              </ul>
            </form>
          </section>

          <ul class="copyright">
            <li>
              Web:
              <a href="http://intranets.nidec-copal.co.th/SystemManagement/"
                >Nidec precision components thailand</a
              >
            </li>
          </ul>
        </div>
      </footer>
    </div>

    <!-- Scripts -->

    <script>
      var resultContainer = document.getElementById("qr-reader-results");
      var lastResult = 0;
      var countResults = 0;
      var countScan = false;

      function setText(model, process, name) {
        document.getElementById("model_name").innerHTML = model;
        document.getElementById("process_name").innerHTML = process;
        document.getElementById("name").innerHTML = name;
      }

      function convertTo24Hour(time12h) {
        const [time, modifier] = time12h.split(" ");

        let [hours, minutes, seconds] = time.split(":");

        if (hours === "12") {
          hours = "00";
        }

        if (modifier === "PM") {
          hours = parseInt(hours, 10) + 12;
        }

        return `${hours}:${minutes}:${seconds}`;
      }

      async function onScanSuccess(decodedText, decodedResult) {
        if (!countScan) {
          countScan = true;
          beep();
          ++countResults;
          lastResult = decodedText;
          // Handle on success condition with the decoded message.
          let temp = JSON.parse(localStorage.getItem("data_" + decodedText));

          if (temp) {
            if (temp["action"] == 0) {
              const responseDataInfo =
                await window.module.$api.user_config.getConfig(
                  `emp='${temp["number"]}'`
                );
              console.log(
                `กิจกรรม ${temp["acitivity"]} : สิ้นสุด ${decodedText}`
              );
              let cal_time =
                Math.abs(
                  Math.abs(new Date().getTime() - parseInt(temp["date"]))
                ) / 1000;
              console.log(
                `ใช้เวลาไป ${
                  Math.floor(parseInt(cal_time) / 60) > 0
                    ? Math.floor(parseInt(cal_time) / 60) + " นาที "
                    : ""
                }${parseInt(cal_time) % 60} วินาที`
              );
              const responseInsert =
                await window.module.$api.user_config.postConfig(
                  {
                    emp: temp["number"],
                    index_ac: 7,
                    process_name: responseDataInfo["data"][0][3],
                    login:
                      new Date(parseInt(temp["date"]))
                        .toLocaleDateString()
                        .replaceAll("/", "-") +
                      " " +
                      convertTo24Hour(
                        new Date(parseInt(temp["date"])).toLocaleTimeString()
                      ),
                    logout:
                      new Date().toLocaleDateString().replaceAll("/", "-") +
                      " " +
                      convertTo24Hour(new Date().toLocaleTimeString()),
                    diff: cal_time,
                  },
                  "time_activity"
                );
              if (
                responseInsert.status === "successful" &&
                responseInsert.data.length > 0
              ) {
                localStorage.setItem(
                  `data_${decodedText}`,
                  JSON.stringify({
                    number: decodedText,
                    action: 1,
                  })
                );
                setText("", "", "");
              }
            } else {
              console.log(`กิจกรรม ${type_activity} : สแกนเจอ ${decodedText}`);
              localStorage.setItem(
                `data_${decodedText}`,
                JSON.stringify({
                  number: decodedText,
                  action: 0,
                  date: new Date().getTime(),
                  acitivity: type_activity,
                })
              );
            }
          } else {
            console.log(`กิจกรรม ${type_activity} : สแกนเจอ ${decodedText}`);
            localStorage.setItem(
              `data_${decodedText}`,
              JSON.stringify({
                number: decodedText,
                action: 0,
                date: new Date().getTime(),
                acitivity: type_activity,
              })
            );
          }

          const response = await window.module.$api.user_config.getConfig(
            `emp='${decodedText}'`
          );
          if (response.status == "successful" && response.data.length > 0) {
            document.getElementById("model_name").innerHTML =
              response.data[0][1];
            document.getElementById("process_name").innerHTML =
              response.data[0][3];
            document.getElementById("name").innerHTML = response.data[0][5];
            localStorage.setItem(
              decodedText,
              JSON.stringify({
                model_name: response.data[0][1],
                process_name: response.data[0][3],
                name: response.data[0][5],
              })
            );
          } else {
            document.getElementById("model_name").innerHTML = "not found";
            document.getElementById("process_name").innerHTML = "not found";
          }
          qrcodeReaderClose();
        }
      }
      var runCamera = false;
      var type_activity = "";
      function qrcodeReaderOpen(type) {
        type_activity = type;
        runCamera = true;
        document.getElementById("qr-reader").style.display = "block";
        document.getElementById("qr-reader").style.top = "20dvh";
        document.getElementById("qr-reader").style.opacity = "1";
        try {
          document
            .getElementById("html5-qrcode-button-camera-permission")
            .click();
        } catch (error) {
          document.getElementById("html5-qrcode-button-camera-start").click();
        }
      }

      function qrcodeReaderClose() {
        runCamera = false;
        countScan = false;
        document.getElementById("qr-reader").style.opacity = "0";
        document.getElementById("qr-reader").style.display = "none";
        document.getElementById("qr-reader").style.top = "-1200dvh";
        document.getElementById("html5-qrcode-button-camera-stop").click();
      }

      function loadPermission() {
        if (!localStorage.getItem("HTML5_QRCODE_DATA")) {
          document
            .getElementById("html5-qrcode-button-camera-permission")
            .click();
          return false;
        }
        return true;
      }

      function beep() {
        var snd = new Audio(
          "data:audio/wav;base64,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qJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU="
        );
        snd.play();
      }
    </script>

    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>
  </body>
</html>
